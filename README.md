# The use and abuse of herbarium specimens in evaluating plant extinction risks
This repository contains the code used to compare methods of classifying species as threatened for the submitted paper "The use and abuse of herbarium specimens in evaluating plant extinction risks".

## Structure
The entire analysis (running the classifications, analysing the results, and producing figures) was run using the *run_analysis.R* script in the root directory.

### analysis
The *run_analysis.R* script calls three separate scripts, which are stored in the **analysis** folder:

1. *run_all_methods.R* - This runs the classification using each method, including any preprocessing and dataset splitting that is required by the method. All methods in this script are run in the same way - the method to use as well as information about any method-specific processing are specified in a list. Intermediate information about each of the methods is saved in an **output** folder, as well as the results for each method and a summary of the overall results from every method.

2. *analyse_results.R* - This uses the results files generated by the previous script to carry out the analyses described in the paper, and saves any results to one Excel file in an **output** folder.

3. *plot_results.R* - This uses the results from the previous analysis script to plot the figures displayed in the paper and supplementary materials, and save them to a **figures** folder.

4. *report_templates* - Is a set of scripts that are rendered as notebooks in an **notebooks** folder, displaying the results of each method, with an overview of the results from all methods as well.

### R
Functions used in the analysis are stored in the **R** folder as separate files according to their use:

1. *classification_functions.R* - Functions common to all classification methods to help run the classification pipeline.

2. *data_processing_functions.R* - Functions used for the preprocessing step of the classification pipeline.

3. *method_functions.R* - Functions defining each of the classification methods used. These are: Random forests, rCAT, ConR, Specimen count, and the US method.

4. *analysis_functions.R* - Functions used to help withe analysis of the classification results.

### scripts
This folder contains scripts written in Python to prepare the predictor data in order to run all of the classifications:

1. *prepare_data.py* - This is the script that prepares the predictors, using raw data from a **data** folder, and saving the complete predictor data to an **output** folder.

2. *redlist_api.py* - This is a class definition for an object that makes calls to the [IUCN Red List API](http://apiv3.iucnredlist.org/), which we used to fill in any gaps in our data.

### others

There is also a **packrat** folder, which contains all of the packages needed to run the analysis. Opening the *threatened_species_classification_comparison.Rproj* file should install all of them.

The *environment.yml* contains a specification of packages used in the Python scripts. An environment can be created with all of these packages installed using [Anaconda](https://conda.io/docs/user-guide/tasks/manage-environments.html#creating-an-environment-from-an-environment-yml-file).
